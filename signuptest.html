<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Westside JH SciOly - Sign Up</title>
  <link rel="icon" type="image/png" href="images/logo.png" />
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Poppins&display=swap" rel="stylesheet" />
  <style>
    :root {
      --main-red: #D62828;
      --dark-base: #1F1F1F;
      --light-base: #F5F5F5;
      --hover-gold: #FFB703;
      --secondary-blue: #0077B6;

      --font-heading: 'Bebas Neue', cursive;
      --font-body: 'Poppins', sans-serif;
    }

    * {
      box-sizing: border-box;
      margin: 0; padding: 0;
    }

    body, html {
      height: 100%;
      font-family: var(--font-body);
      background-color: var(--dark-base);
      color: var(--light-base);
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* HEADER */
    header {
      background-color: var(--main-red);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-family: var(--font-heading);
      font-size: 1.8rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      z-index: 10;
      position: relative;
    }

    .nav-list {
      list-style: none;
      display: flex;
      gap: 1.5rem;
      padding: 0;
      margin: 0;
      align-items: center;
    }

    .nav-list li a {
      color: var(--hover-gold);
      font-family: var(--font-body);
      font-weight: 600;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      transition: all 0.3s ease;
      text-decoration: none;
    }

    .nav-list li a:hover {
      color: white;
      text-decoration: none;
      transform: translateY(-2px);
    }

    /* FORM CONTAINER */
    main.signup-container {
      flex-grow: 1;
      background: linear-gradient(135deg, rgba(214,40,40,0.85), rgba(255,183,3,0.85));
      border-radius: 15px;
      padding: 2rem;
      box-shadow: 0 0 25px rgba(255, 183, 3, 0.9);
      color: var(--light-base);
      font-family: var(--font-body);
      max-width: 900px;
      margin: 2rem auto 3rem auto;
      overflow-y: auto;
    }

    main.signup-container h2 {
      font-family: var(--font-heading);
      text-align: center;
      margin-bottom: 2rem;
      font-size: 2.8rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--hover-gold);
      text-shadow: 0 0 8px rgba(255,183,3,0.9);
    }

    /* FORM STEPS */
    form {
      width: 100%;
    }
    .step {
      display: none;
    }
    .step.active {
      display: block;
      animation: fadeIn 0.5s ease-in-out;
    }
    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(15px);}
      to {opacity: 1; transform: translateY(0);}
    }

    label {
      display: block;
      margin-bottom: 0.4rem;
      font-weight: 600;
      color: var(--hover-gold);
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    input[type="text"],
    input[type="email"],
    input[type="password"],
    select,
    textarea {
      width: 100%;
      padding: 0.65rem 1rem;
      margin-bottom: 1.2rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-family: var(--font-body);
      outline: none;
      transition: box-shadow 0.3s ease;
    }

    input[type="text"]:focus,
    input[type="email"]:focus,
    input[type="password"]:focus,
    select:focus,
    textarea:focus {
      box-shadow: 0 0 10px var(--hover-gold);
      background-color: #fffbea;
      color: var(--dark-base);
    }

    /* ===== PARTICLES CANVAS ===== */
    #particles-js {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0; left: 0;
      z-index: 0;
      pointer-events: none;
    }

    /* Multi-select event picker */
    select[multiple] {
      height: 120px;
      font-size: 1rem;
    }

    /* BUTTONS */
    .btn-row {
      display: flex;
      justify-content: space-between;
      margin-top: 1rem;
    }
    button {
      padding: 0.75rem 1.8rem;
      background-color: var(--main-red);
      color: var(--light-base);
      font-family: var(--font-heading);
      font-size: 1.1rem;
      letter-spacing: 0.08em;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button:hover:not(:disabled) {
      background-color: var(--hover-gold);
      color: var(--dark-base);
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* PROGRESSBAR */
    .progressbar {
      counter-reset: step;
      display: flex;
      justify-content: space-between;
      margin-bottom: 2rem;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    .progressbar li {
      list-style-type: none;
      width: 100%;
      text-align: center;
      position: relative;
      font-family: var(--font-heading);
      font-weight: 700;
      color: var(--light-base);
      letter-spacing: 0.1em;
      font-size: 0.9rem;
      text-transform: uppercase;
      cursor: default;
    }
    .progressbar li::before {
      content: counter(step);
      counter-increment: step;
      width: 28px;
      height: 28px;
      line-height: 28px;
      display: block;
      font-size: 1.1rem;
      color: var(--main-red);
      background: var(--light-base);
      border-radius: 50%;
      margin: 0 auto 10px auto;
      box-shadow: 0 0 8px rgba(255, 183, 3, 0.9);
    }
    .progressbar li.active {
      color: var(--hover-gold);
    }
    .progressbar li.active::before {
      background: var(--hover-gold);
      color: var(--dark-base);
      box-shadow: 0 0 10px var(--hover-gold);
    }

    /* TERMS & CONDITIONS SCROLLBOX */
    .terms-text {
      background: #fffbeaee;
      border-radius: 12px;
      color: var(--dark-base);
      font-weight: 600;
      font-size: 0.85rem;
      padding: 1rem;
      max-height: 160px;
      overflow-y: auto;
      box-shadow: 0 0 10px var(--hover-gold);
      margin-bottom: 1.5rem;
    }

    /* GOOGLE SIGN-IN BUTTON */
    #googleSignInBtn {
      background-color: var(--secondary-blue);
      margin: 1rem auto 2rem auto;
      display: block;
      padding: 0.75rem 1.8rem;
      font-family: var(--font-heading);
      font-size: 1.1rem;
      letter-spacing: 0.08em;
      border: none;
      border-radius: 12px;
      color: var(--light-base);
      cursor: pointer;
      transition: background-color 0.3s ease;
      user-select: none;
      max-width: 300px;
    }
    #googleSignInBtn:hover {
      background-color: #005f8f;
    }

    /* ===== FOOTER ===== */
    footer {
      background-color: var(--main-red);
      color: var(--light-base);
      padding: 1rem 2rem;
      text-align: center;
      font-size: 0.9rem;
      font-weight: 600;
      position: relative;
      z-index: 10;
    }
    footer a {
      color: var(--hover-gold);
      text-decoration: none;
      font-weight: 700;
      transition: color 0.3s ease;
    }

    footer a:hover {
      color: white;
      text-decoration: underline;
    }

    /* Responsive */
    @media (max-width: 600px) {
      header {
        flex-direction: column;
        gap: 1rem;
      }
      main.signup-container {
        margin: 1rem;
        padding: 1.5rem;
      }
      .progressbar {
        max-width: 100%;
      }
    }

    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 9999;
      padding-top: 100px;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.7);
      animation: fadeIn 0.3s ease forwards;
    }
    .modal.show {
      display: block;
    }
    .modal-content {
      background-color: var(--light-base);
      margin: auto;
      padding: 2rem;
      border-radius: 12px;
      width: 80%;
      max-width: 600px;
      box-shadow: 0 0 20px var(--hover-gold);
      color: var(--dark-base);
      font-family: var(--font-body);
      position: relative;
      max-height: 80vh;
      overflow-y: auto;
      animation: slideDown 0.3s ease forwards;
    }
    .close-button {
      color: var(--main-red);
      position: absolute;
      top: 12px;
      right: 20px;
      font-size: 2rem;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
      transition: color 0.2s ease;
    }
    .close-button:hover {
      color: var(--hover-gold);
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-15px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

  </style>
</head>
<body>
  <header>
    <div>Westside JH SciOly </div>
    <nav>
      <ul class="nav-list">
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About Us</a></li>
        <li><a href="events.html">Events</a></li>
        <li><a href="resources.html">Resources</a></li>
        <li><a href="accomplishments.html">Accomplishments</a></li>
        <li><a href="donate.html">Donate</a></li>
        <li><a href="contact.html">Contact</a></li>
        <li><a href="memberportal.html">Member Portal</a></li>
      </ul>
    </nav>
  </header>

  <main class="signup-container">
    <h2>Sign Up for Westside SciOly</h2>

    <button id="googleSignInBtn" type="button">Sign in with Google</button>

    <ul class="progressbar">
      <li class="active">Account Info</li>
      <li>Quiz</li>
      <li>Events</li>
      <li>Terms</li>
    </ul>

    <form id="signup-form" novalidate>
      <!-- STEP 1: Account Info -->
      <section class="step active" data-step="0">
        <label for="realName">Full Name</label>
        <input type="text" id="realName" name="realName" placeholder="Your real name" required />

        <label for="username">Preferred Username (optional)</label>
        <input type="text" id="username" name="username" placeholder="Username" />

        <label for="email">Email Address</label>
        <input type="email" id="email" name="email" placeholder="you@example.com" required />

        <label for="password">Password</label>
        <input type="password" id="password" name="password" placeholder="Choose a strong password" required minlength="6" />
      </section>

      <!-- STEP 2: Quiz Sample -->
      <section class="step" data-step="1">
        <label for="quiz-q1">Which event sounds the most fun?</label>
        <select id="quiz-q1" name="quiz-q1" required>
          <option value="" disabled selected>Choose an option</option>
          <option value="life-science">Life Science</option>
          <option value="chemistry">Chemistry</option>
          <option value="build">Build</option>
          <option value="earth-space">Earth & Space</option>
        </select>
        <small style="color:#fffacd; font-weight:600;">(You can add more quiz questions here, just copy this block!)</small>
      </section>

      <!-- STEP 3: Events Selection -->
      <section class="step" data-step="2">
        <label for="eventSelect">Select your preferred events (up to 3)</label>
        <select id="eventSelect" name="events" multiple size="6" required>
          <option value="life-science">Life Science</option>
          <option value="chemistry">Chemistry</option>
          <option value="build">Build</option>
          <option value="earth-space">Earth & Space</option>
          <option value="inquiry-tech">Inquiry & Technology</option>
          <option value="math-tech">Math & Technology</option>
        </select>
        <small style="color:#fffacd; font-weight:600;">(Ctrl/Cmd + click to select multiple)</small>
      </section>

      <!-- STEP 4: Terms & Conditions -->
      <section class="step" data-step="3">
        <div class="terms">
          <input type="checkbox" id="terms" name="terms" required />
          <label for="terms">
            I agree to the 
            <a href="#" id="openTermsModal" aria-haspopup="dialog" aria-controls="termsModal">Terms & Conditions</a>
          </label>
        </div>

        <div class="terms-text" tabindex="0" role="region" aria-label="Terms and Conditions Text">
          <p><strong>Sample Terms & Conditions:</strong></p>
          <p>By signing up for Westside SciOly, you agree to abide by all team rules and conduct policies. Your information will be securely stored and used solely for team communication and event registration. You confirm that you are authorized to participate and understand the commitment involved.</p>
          <p>Please review our full policies on our website before proceeding.</p>
        </div>

        <button type="submit" id="submitBtn">Sign Up & Submit</button>
      </section>

      <div class="btn-row" style="margin-top: 1.5rem;">
        <button type="button" id="prevBtn" disabled>Previous</button>
        <button type="button" id="nextBtn">Next</button>
      </div>
    </form>
  </main>

  <footer>
    &copy; 2025 Westside JH SciOly | Contact us at 
    <a href="mailto:info@westsidescioly.com">info@westsidescioly.com</a>
  </footer>

  <canvas id="particles-js"></canvas>

  <!-- Simple particle animation script -->
  <script>
    const canvas = document.getElementById('particles-js');
    const ctx = canvas.getContext('2d');
    let particlesArray;

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    class Particle {
      constructor() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.size = Math.random() * 2 + 1;
        this.speedX = (Math.random() - 0.5) * 0.5;
        this.speedY = (Math.random() - 0.5) * 0.5;
        this.color = 'rgba(255, 183, 3, 0.8)';
      }
      update() {
        this.x += this.speedX;
        this.y += this.speedY;
        if (this.x < 0 || this.x > canvas.width) this.speedX *= -1;
        if (this.y < 0 || this.y > canvas.height) this.speedY *= -1;
      }
      draw() {
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function init() {
      particlesArray = [];
      for (let i = 0; i < 80; i++) {
        particlesArray.push(new Particle());
      }
    }

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      particlesArray.forEach(particle => {
        particle.update();
        particle.draw();
      });
      requestAnimationFrame(animate);
    }

    window.addEventListener('resize', () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      init();
    });

    init();
    animate();
  </script>

  <!-- FIREBASE + FORM LOGIC -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "westside-scioly.firebaseapp.com",
      projectId: "westside-scioly",
      storageBucket: "westside-scioly.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // Form navigation and validation
    const form = document.getElementById('signup-form');
    const steps = document.querySelectorAll('.step');
    const nextBtn = document.getElementById('nextBtn');
    const prevBtn = document.getElementById('prevBtn');
    const progressbar = document.querySelectorAll('.progressbar li');
    let currentStep = 0;

    function showStep(n) {
      steps.forEach((step, i) => {
        step.classList.toggle('active', i === n);
        progressbar[i].classList.toggle('active', i <= n);
      });
      prevBtn.disabled = n === 0;
      nextBtn.style.display = (n === steps.length - 1) ? 'none' : 'inline-block';
      form.querySelector('#submitBtn').style.display = (n === steps.length - 1) ? 'inline-block' : 'none';
      // Focus first input on the step for keyboard users
      const firstInput = steps[n].querySelector('input, select, textarea, button');
      if (firstInput) firstInput.focus();
    }

    function validateStep(stepIndex) {
      const step = steps[stepIndex];
      const inputs = step.querySelectorAll('input, select, textarea');
      for (const input of inputs) {
        if (!input.checkValidity()) {
          input.reportValidity();
          return false;
        }
      }
      // Extra validation for multi-select max 3 events
      if (stepIndex === 2) {
        const selected = step.querySelector('#eventSelect').selectedOptions;
        if (selected.length === 0 || selected.length > 3) {
          alert("Please select between 1 and 3 events.");
          return false;
        }
      }
      // Extra validation on terms checkbox at step 3 (final step)
      if (stepIndex === 3) {
        const termsCheckbox = step.querySelector('#terms');
        if (!termsCheckbox.checked) {
          alert("You must agree to the Terms & Conditions to sign up.");
          return false;
        }
      }
      return true;
    }

    nextBtn.addEventListener('click', () => {
      if (!validateStep(currentStep)) return;
      currentStep++;
      showStep(currentStep);
    });

    prevBtn.addEventListener('click', () => {
      currentStep--;
      showStep(currentStep);
    });

    form.addEventListener('submit', async e => {
      e.preventDefault();
      if (!validateStep(currentStep)) return;

      // Gather form data
      const realName = form.realName.value.trim();
      const username = form.username.value.trim() || null;
      const email = form.email.value.trim();
      const password = form.password.value;
      const events = Array.from(form['events'].selectedOptions).map(o => o.value);
      const termsAccepted = form.terms.checked;

      if (!termsAccepted) {
        alert("You must agree to the Terms & Conditions to sign up.");
        return;
      }

      try {
        // Create user with email/password
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        // TODO: Save additional user info (realName, username, events) to Firestore or Realtime DB here

        alert(`Welcome, ${realName}! Your signup was successful.`);
        form.reset();
        currentStep = 0;
        showStep(currentStep);
        // Redirect to member dashboard or show success message
        // window.location.href = "memberdashboard.html";
      } catch (error) {
        alert("Error during sign up: " + error.message);
      }
    });

    // Google Sign-In button
    const googleSignInBtn = document.getElementById('googleSignInBtn');
    googleSignInBtn.addEventListener('click', async () => {
      try {
        const result = await signInWithPopup(auth, provider);
        const user = result.user;

        // TODO: Save user info and handle new/existing users

        alert(`Welcome, ${user.displayName}! You signed in with Google.`);
        // Redirect or show dashboard
        // window.location.href = "memberdashboard.html";
      } catch (error) {
        alert("Google sign-in failed: " + error.message);
      }
    });

    // Initialize first step
    showStep(currentStep);

    // ======= MODAL LOGIC FOR TERMS & CONDITIONS =======
    const openTermsBtn = document.getElementById('openTermsModal');
    const modalHTML = `
      <div id="termsModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="termsTitle">
        <div class="modal-content" tabindex="0">
          <span class="close-button" role="button" aria-label="Close Terms and Conditions">&times;</span>
          <h2 id="termsTitle" style="color: var(--main-red); font-family: var(--font-heading); letter-spacing: 0.1em; margin-bottom: 1rem;">Terms & Conditions</h2>
          <div style="max-height: 60vh; overflow-y: auto; color: var(--dark-base); font-weight: 600; line-height: 1.4; font-size: 0.95rem;">
            <p>By signing up for Westside SciOly, you agree to abide by all team rules and conduct policies. Your information will be securely stored and used solely for team communication and event registration. You confirm that you are authorized to participate and understand the commitment involved.</p>
            <p>Participation requires respect for teammates and adherence to safety guidelines. Sharing of login credentials or falsification of information will result in disqualification.</p>
            <p>We reserve the right to contact guardians for participants under 18 years old. Your privacy is important; data will not be shared outside of authorized team members.</p>
            <p>Please review our full policies on the official website. By continuing, you acknowledge these terms.</p>
          </div>
        </div>
      </div>
    `;
    // Append modal to body (hidden initially)
    document.body.insertAdjacentHTML('beforeend', modalHTML);

    const termsModal = document.getElementById('termsModal');
    const closeBtn = termsModal.querySelector('.close-button');
    const modalContent = termsModal.querySelector('.modal-content');

    function openModal() {
      termsModal.classList.add('show');
      document.body.style.overflow = 'hidden'; // disable background scroll
      modalContent.focus();
    }
    function closeModal() {
      termsModal.classList.remove('show');
      document.body.style.overflow = ''; // restore scroll
      openTermsBtn.focus();
    }

    openTermsBtn.addEventListener('click', e => {
      e.preventDefault();
      openModal();
    });
    closeBtn.addEventListener('click', closeModal);

    // Close modal on clicking outside content
    termsModal.addEventListener('click', e => {
      if (e.target === termsModal) closeModal();
    });

    // Close modal on ESC key
    document.addEventListener('keydown', e => {
      if (e.key === "Escape" && termsModal.classList.contains('show')) {
        closeModal();
      }
    });

    // Trap focus inside modal (accessibility)
    modalContent.addEventListener('keydown', e => {
      const focusableElements = modalContent.querySelectorAll('a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])');
      const firstEl = focusableElements[0];
      const lastEl = focusableElements[focusableElements.length -1];

      if (e.key === 'Tab') {
        if (e.shiftKey) {
          // Shift + Tab
          if (document.activeElement === firstEl) {
            e.preventDefault();
            lastEl.focus();
          }
        } else {
          // Tab
          if (document.activeElement === lastEl) {
            e.preventDefault();
            firstEl.focus();
          }
        }
      }
    });
  </script>
</body>
</html>