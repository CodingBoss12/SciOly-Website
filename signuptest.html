<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Westside JH SciOly - Sign Up</title>
  <link rel="icon" type="image/png" href="images/logo.png" />
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Poppins&display=swap" rel="stylesheet" />
  <style>
    :root {
      --main-red: #D62828;
      --dark-base: #1F1F1F;
      --light-base: #F5F5F5;
      --hover-gold: #FFB703;
      --secondary-blue: #0077B6;
      --font-heading: 'Bebas Neue', cursive;
      --font-body: 'Poppins', sans-serif;
    }
    * {
      box-sizing: border-box;
      margin: 0; padding: 0;
    }
    body, html {
      height: 100%;
      font-family: var(--font-body);
      background-color: var(--dark-base);
      color: var(--light-base);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      background-color: var(--main-red);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-family: var(--font-heading);
      font-size: 1.8rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      z-index: 10;
      position: relative;
    }
    nav ul {
      list-style: none;
      display: flex;
      gap: 1.5rem;
      align-items: center;
    }
    nav ul li a {
      color: var(--hover-gold);
      font-family: var(--font-body);
      font-weight: 600;
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      transition: all 0.3s ease;
      text-decoration: none;
    }
    nav ul li a:hover {
      color: white;
      transform: translateY(-2px);
    }
    footer {
      background-color: var(--main-red);
      color: var(--light-base);
      padding: 1rem 2rem;
      text-align: center;
      font-size: 0.9rem;
      font-weight: 600;
      margin-top: auto;
    }
    main.signup-container {
      flex-grow: 1;
      max-width: 600px;
      margin: 2rem auto 4rem auto;
      padding: 2rem;
      background-color: #2B2B2B;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(214,40,40,0.7);
      font-family: var(--font-body);
    }
    form label {
      display: block;
      margin-bottom: 0.4rem;
      cursor: pointer;
    }
    input[type="text"],
    input[type="email"],
    input[type="password"],
    input[type="radio"],
    input[type="checkbox"] {
      font-size: 1rem;
      margin-bottom: 1rem;
    }
    input[type="text"],
    input[type="email"],
    input[type="password"] {
      width: 100%;
      padding: 0.6rem 0.8rem;
      border-radius: 6px;
      border: none;
      font-family: var(--font-body);
    }
    input[type="radio"],
    input[type="checkbox"] {
      margin-right: 0.5rem;
    }
    button.next-btn,
    button.prev-btn,
    button.submit-btn {
      background-color: var(--hover-gold);
      border: none;
      color: var(--dark-base);
      padding: 0.6rem 1.3rem;
      border-radius: 6px;
      font-weight: 700;
      cursor: pointer;
      transition: background-color 0.25s ease;
      margin-top: 1rem;
      user-select: none;
    }
    button.next-btn:disabled {
      background-color: #a88603;
      cursor: not-allowed;
    }
    button.next-btn:hover:not(:disabled),
    button.prev-btn:hover,
    button.submit-btn:hover {
      background-color: #ffc65a;
    }
    .form-step {
      animation: fadeInStep 0.3s ease forwards;
      display: none;
    }
    .form-step.active {
      display: block;
    }
    #progress-bar-container {
      margin-bottom: 1.5rem;
      background: #555;
      border-radius: 3px;
      height: 6px;
      overflow: hidden;
    }
    #progress-bar {
      height: 100%;
      background: var(--hover-gold);
      width: 0%;
      transition: width 0.3s ease-in-out;
    }
    #events-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    #events-error {
      color: var(--hover-gold);
      font-weight: 700;
      margin-top: 0.5rem;
      display: none;
    }
    .quiz-step {
      max-height: 60vh;
      overflow-y: auto;
    }
    .terms-container {
      margin-top: 1rem;
      font-size: 0.95rem;
      user-select: none;
      display: flex;
      align-items: center;
    }
    .terms-container input[type="checkbox"] {
      margin-right: 0.6rem;
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    .terms-container label a {
      color: var(--hover-gold);
      text-decoration: underline;
      cursor: pointer;
    }
    .error-message {
      color: #ff6b6b;
      font-weight: 600;
      margin-top: -0.5rem;
      margin-bottom: 1rem;
      font-size: 0.9rem;
    }
    @keyframes fadeInStep {
      from {opacity: 0; transform: translateY(10px);}
      to {opacity: 1; transform: translateY(0);}
    }
    @media (max-width: 600px) {
      main.signup-container {
        margin: 1rem;
        padding: 1rem;
      }
    }
  </style>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDnGd4encwMoRl7i7ks0Dkpxy_h_glxYUw",
      authDomain: "westside-scioly.firebaseapp.com",
      projectId: "westside-scioly",
      storageBucket: "westside-scioly.firebasestorage.app",
      messagingSenderId: "795634851228",
      appId: "1:795634851228:web:b297b85b9b1ad05fa5fc59",
      measurementId: "G-0YF1862VQD"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore();

    const form = document.getElementById('signup-form');
    const steps = [...document.querySelectorAll('.form-step')];
    const progressBar = document.getElementById('progress-bar');
    let currentStep = 0;

    // Navigation buttons
    const nextBtns = document.querySelectorAll('.next-btn');
    const prevBtns = document.querySelectorAll('.prev-btn');
    const submitBtn = document.getElementById('submit-btn');

    // Quiz toggle radios & event checkboxes
    const takeQuizRadios = document.getElementsByName('takeQuiz');
    const nextBtn2 = document.getElementById('next-btn-2');
    const eventsList = document.getElementById('events-list');
    const eventsCheckboxes = eventsList.querySelectorAll('input[type="checkbox"]');
    const nextBtn4 = document.getElementById('next-btn-4');
    const eventsError = document.getElementById('events-error');
    const reviewInfo = document.getElementById('review-info');

    // Terms checkbox
    let termsCheckbox;
    function createTermsCheckbox() {{
      const container = document.createElement('div');
      container.className = 'terms-container';
      container.innerHTML = `
        <input type="checkbox" id="terms" />
        <label for="terms">I accept the <a href="terms.html" target="_blank" rel="noopener">terms and conditions</a></label>
      `;
      return container;
    }}

    // Add terms checkbox to last step submit section
    function addTermsToSubmit() {{
      const submitSection = steps.find(s => s.dataset.step === "5");
      if (!submitSection.querySelector('.terms-container')) {{
        const termsElem = createTermsCheckbox();
        submitSection.insertBefore(termsElem, submitBtn);
        termsCheckbox = termsElem.querySelector('#terms');
      }}
    }}

    // Update progress bar
    function updateProgressBar() {{
      const progress = ((currentStep + 1) / steps.length) * 100;
      progressBar.style.width = progress + '%';
    }}

    // Show step by index
    function showStep(index) {{
      steps.forEach((step, i) => {{
        step.classList.toggle('active', i === index);
      }});
      currentStep = index;
      updateProgressBar();

      // Enable buttons based on step logic
      if (index === 1) {{
        nextBtn2.disabled = ![...takeQuizRadios].some(r => r.checked);
      }}
      if (index === 3) {{
        validateEvents();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
      if (index === 4) {{
        fillReview();
      }}
    }}

    // Quiz toggle enable next
    [...takeQuizRadios].forEach(radio => {{
      radio.addEventListener('change', () => {{
        nextBtn2.disabled = false;
      }});
    }});

    // Validate max 6 events
    function validateEvents() {
      const checkedCount = [...eventsCheckboxes].filter(cb => cb.checked).length;
      if (checkedCount > 6) {{
        eventsError.style.display = 'block';
        nextBtn4.disabled = true;
      }} else if (checkedCount === 0) {{
        eventsError.textContent = "Please select at least one event.";
        eventsError.style.display = 'block';
        nextBtn4.disabled = true;
      }} else {{
        eventsError.style.display = 'none';
        nextBtn4.disabled = false;
      }}
    }
    eventsList.addEventListener('change', validateEvents);

    // Auto-fill events from quiz answers (basic scoring)
    function getQuizRecommendations() {
      let recommended = [];
      const quizAnswers = {};
      for (let i = 1; i <= 5; i++) {{
        const answer = form['q' + i]?.value;
        quizAnswers['q' + i] = answer;
      }}
      if (quizAnswers.q1 === 'A') recommended.push("Anatomy and Physiology");
      if (quizAnswers.q2 === 'A') recommended.push("Disease Detectives");
      if (quizAnswers.q3 === 'A') recommended.push("Heredity");
      if (quizAnswers.q4 === 'A') recommended.push("Dynamic Planet");
      if (quizAnswers.q5 === 'A') recommended.push("Meteorology");
      [...eventsCheckboxes].forEach(cb => {{
        cb.checked = recommended.includes(cb.value);
      }});
    }

    // Fill review step
    function fillReview() {{
      const realName = form.realName.value.trim();
      const email = form.email.value.trim();
      const username = form.username.value.trim() || "(none)";
      const eventsSelected = [...eventsCheckboxes]
        .filter(cb => cb.checked)
        .map(cb => cb.value);
      reviewInfo.innerHTML = `
        <p><strong>Full Name:</strong> ${realName}</p>
        <p><strong>Email:</strong> ${email}</p>
        <p><strong>Username:</strong> ${username}</p>
        <p><strong>Events Selected:</strong> ${eventsSelected.length > 0 ? eventsSelected.join(', ') : "None"}</p>
      `;
    }}

    // Navigation button handlers
    nextBtns.forEach(btn => {{
      btn.addEventListener('click', () => {{
        if (currentStep === 1) {{
          const takeQuiz = [...takeQuizRadios].find(r => r.checked)?.value;
          if (takeQuiz === 'yes') {{
            showStep(2);
          }} else {{
            showStep(3);
          }}
        }} else if (currentStep === 2) {{
          const answeredAll = [...form.querySelectorAll('.form-step[data-step="3"] input[type="radio"]')]
            .every(input => {{
              const name = input.name;
              return form[name].value;
            }});
          if (!answeredAll) {{
            alert("Please answer all quiz questions.");
            return;
          }}
          getQuizRecommendations();
          showStep(3);
        }} else if (currentStep === 3) {{
          showStep(4);
        }} else if (currentStep === 4) {{
          if (nextBtn4.disabled) {{
            alert("Please select up to 6 events.");
            return;
          }}
          showStep(5);
          addTermsToSubmit();
        }}
      }});
    }});

    prevBtns.forEach(btn => {{
      btn.addEventListener('click', () => {{
        if (currentStep > 0) showStep(currentStep - 1);
      }});
    }});

    // Form submission
    form.addEventListener('submit', async (e) => {{
      e.preventDefault();
      submitBtn.disabled = true;
      submitBtn.textContent = "Submitting...";

      if (!form.realName.value.trim() || !form.email.value.trim() || !form.password.value) {{
        alert("Please fill all required fields.");
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit";
        return;
      }}
      const selectedEvents = [...eventsCheckboxes]
        .filter(cb => cb.checked)
        .map(cb => cb.value);
      if (selectedEvents.length === 0 || selectedEvents.length > 6) {{
        alert("Please select 1 to 6 events.");
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit";
        return;
      }}

      if (!termsCheckbox?.checked) {{
        alert("Please accept the terms and conditions before submitting.");
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit";
        return;
      }}

      try {{
        const userCredential = await createUserWithEmailAndPassword(auth, form.email.value.trim(), form.password.value);
        const user = userCredential.user;

        await setDoc(doc(db, 'users', user.uid), {
          realName: form.realName.value.trim(),
          email: form.email.value.trim(),
          username: form.username.value.trim() || null,
          events: selectedEvents,
          createdAt: serverTimestamp()
        });

        alert("Welcome to Westside JH SciOly! Your account has been created.");
        window.location.href = "memberdashboard.html";
      }} catch (error) {{
        alert("Error: " + error.message);
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit";
      }}
    }});

    // Initialize first step
    showStep(0);
  </script>
</body>
</html>
